<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<title>Pinjump</title>
	<style>
        :root {
            --color-hud: #33f0ff;
            /* --color-hud: #ff9911; */
            --color-success: #77ff46;
            --color-fail: #dd1e28;
            --filter-glow-hud: drop-shadow(0 0 2px #00aadd) drop-shadow(0 0 100px #000000);
            /* --filter-glow-hud: drop-shadow(0 0 2px #aa8811) drop-shadow(0 0 100px #000000); */
            --filter-glow-success: drop-shadow(0 0 2px #55dd22) drop-shadow(0 0 100px #000000);
            --filter-glow-fail: drop-shadow(0 0 2px #990811) drop-shadow(0 0 100px #000000);
            --filter-frame-glow-hud: drop-shadow(0 0 4px #00aadd);
            /* --filter-frame-glow-hud: drop-shadow(0 0 4px #aa8811); */

            --difficulty-open-height: 8em;
            --difficulty-closed-height: 4em;
        }

        * {
            color: var(--color-hud);
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Consolas, Courier, monospace;
            /* font-weight: bold; */
            white-space: pre;
        }

        body {
            background-color: #111118;
            min-height: 500px;
        }

        .flex-row {
            display: flex;
            flex-direction: row;
        }
        .flex-col {
            display: flex;
            flex-direction: column;
        }
        .bordered-widget {
            background-color: #33333308;
            filter: var(--filter-glow-hud);
            overflow: hidden;
            padding: 1em;
        }

        #background { /* fixed-pos blurred bg image */
            /*background-image: url('source/DALLE\ -\ Blue\ Flow.webp'); /* generated by DALLE */
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            filter: blur(8px);
            -webkit-filter: blur(8px);
            opacity: 0.4;
            display: block;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .frame-top, .frame-bot {
            border: 1px solid var(--color-hud);
            filter: var(--filter-frame-glow-hud);
            display: inline-block;
            position: absolute;
            height: 1.25em;
            width: 100%;
            left: 0;
        }
        .frame-top {
            border-bottom: none;
            top: 0;
        }
        .frame-bot {
            border-top: none;
            bottom: 0;
        }
        .frame-left, .frame-right {
            border: 1px solid var(--color-hud);
            filter: var(--filter-frame-glow-hud);
            display: inline-block;
            position: absolute;
            height: 100%;
            width: 1.25em;
            top: 0;
        }
        .frame-left {
            border-right: none;
            left: 0;
        }
        .frame-right {
            border-left: none;
            right: 0;
        }

        /* LOCK VISUALIZER (CENTER FOCUS) */

        /* CONSOLE WIDGET (TOP-LEFT) */
        #log {
            position: absolute;
            top: 1vmax;
            left: 1vmax;
        }

        /* CONTROLS WIDGET (BOTTOM-LEFT) */
        #controls-widget {
            filter: var(--filter-glow-hud);
            position: absolute;
            bottom: 2em;
            left: 2em;
            gap: 0.5em;
        }
        .controls-key, .controls-spacebar {
            cursor: pointer;
            border: 2px solid var(--color-hud);
            border-radius: 0.5em;
            display: inline-block;
            font-size: 1.5em;
            text-align: center;
            align-self: center;
        }
        .controls-key {
            width: 2em;
            height: 2em;
        }
        .controls-spacebar {
            width: 5em;
            height: 2em;
        }
    </style>
</head>
<body>

    <div id='background'></div>
    <div id='log' class='bordered-widget'>
        <div class='frame-top'></div>
        <div class='frame-bot'></div>
    </div>
    <div id='lock-box'></div>

    <script type='text/javascript'>

        //// DOM ////

        const msgLog = document.getElementById('log');

        const MSG_INSTRUCTIONS = [
            'CONTROLS',
            '',
            '(game currently only playable from console)',
            `(press [F12] to open, or whatever your browser's hotkey is)`,
            '',
            '("reset(n)" for new game with position n empty)',
            '("tryMove(from,to)" to jump a pin; true if move executed, false if move invalid)',
            '("renderBoard()" to print board state)'

        ].join('\n');
        msgLog.innerHTML = MSG_INSTRUCTIONS + `<div class = 'frame-top'></div><div class = 'frame-bot'></div>`;

        const CSSVars = {
            get : (k) => getComputedStyle(document.documentElement).getPropertyValue(k),
            set : (k,v) => document.documentElement.style.setProperty(k,v)
        };
        const randI = (min,max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const randInt = (min,max) => {
            if (min > max) [min,max] = [max,min];
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        

        
        // function encBoardState (a) {
        // 	let mask = 0;
        // 	for (let i = 0; i < a.length; i++) {
        // 		mask |= a[i] << i;
        // 	}
        // 	return mask;
        // }
        // function decBoardState (mask,n=4) {
        // 	let a = [];
        // 	for (let i = 0; i < n; i++) {
        // 		a.push( !!(mask & 1<<i) );
        // 	}
        // 	return a;
        // }

        // console.log( encBoardState([true,false,true,true]).toString(2) );
        // console.log( decBoardState( encBoardState([true,false,true,true]) ) );

        // function getPosition (row,col) {
        // 	let sumrows = 0;
        // 	let nextrow = 1;
        // 	for (let i = 0; i < row; i++) {
        // 		sumrows += nextrow;
        // 		nextrow++;
        // 	}
        // 	return sumrows + col;
        // }
        // console.log(getPosition(0,0));
        // console.log(getPosition(1,0));
        // console.log(getPosition(1,1));
        // console.log(getPosition(2,0));
        // console.log(getPosition(2,1));
        // console.log(getPosition(2,2));

        // function getCoords (n) {
        // 	if (n == 0) return [0,0];
        // 	let sumrows = 0;
        // 	let nextrow = 1;
        // 	while (sumrows + nextrow <= n) {
        // 		sumrows += nextrow;
        // 		nextrow++;
        // 	}
        // 	const row = nextrow - 1;
        // 	const col = n - sumrows;
        // 	return [row,col,nextrow];
        // }
        // for (let i = 0; i < 15; i++) {
        // 	console.log(getCoords(i));
        // }

        // function allMovesFrom (from,maxRows) {
        // 	const [row,col,rowWidth] = getCoords(from);
        // 	let moves = []; // 6 possible moves in hex out from origin
        // 	if (row >= 2 && col >= 2) {
        // 		moves.push( getPosition(row-2,col-2) ); // top-left
        // 		moves.push( getPosition(row  ,col-2) ); // mid-left
        // 	}
        // 	if (row >= 2 && col <= rowWidth-2) {
        // 		moves.push( getPosition(row-2,col  ) ); // top-right
        // 		moves.push( getPosition(row  ,col+2) ); // mid-right
        // 	}
        // 	if (row <= maxRows-2                     ) moves.push( getPosition(row+2,col  ) ); // bot-left
        // 	if (row <= maxRows-2 && col <= rowWidth-2) moves.push( getPosition(row+2,col+2) ); // bot-right
        // 	return moves;
        // }



        // function PinjumpController () {
        // 	let board = [];
        // 	//
        // 	return {
                
        // 	};
        // }



        //      0
        //     1 2
        //    3 4 5
        //   6 7 8 9
        //10 11 12 13 14
        const VALID_MOVES = [
            [{over:1,to:3},{over:2,to:5}], // 0
            [{over:3,to:6},{over:4,to:8}], // 1
            [{over:4,to:7},{over:5,to:9}], // 2
            [{over:1,to:0},{over:4,to:5},{over:6,to:10},{over:7,to:12}], // 3
            [{over:7,to:11},{over:8,to:13}], // 4
            [{over:2,to:0},{over:4,to:3},{over:8,to:12},{over:9,to:14}], // 5
            [{over:3,to:1},{over:7,to:8}], // 6
            [{over:4,to:2},{over:8,to:9}], // 7
            [{over:4,to:1},{over:7,to:6}], // 8
            [{over:5,to:2},{over:8,to:7}], // 9
            [{over:6,to:3},{over:11,to:12}], // 10
            [{over:7,to:4},{over:12,to:13}], // 11
            [{over:7,to:3},{over:8,to:5},{over:11,to:10},{over:13,to:14}], // 12
            [{over:8,to:4},{over:12,to:11}], // 13
            [{over:9,to:5},{over:13,to:12}] // 14
        ];

        let board;

        function isValidMove (from,to) {
            for (let move of VALID_MOVES[from]) {
                if (move.to == to) return true;
            }
            return false;
        }
        function validMovesFrom (from) {
            if (!board[from]) return []; // no moves if no piece at that position
            let moves = [];
            for (let move of VALID_MOVES[from]) {
                if (board[move.over] && !board[move.to]) moves.push(move); // can move if there's a pin to jump, and an empty space after
            }
            return moves;
        }
        function getBetween (from,to) {
            for (let move of VALID_MOVES[from]) {
                if (move.to == to) return move.over;
            }
            return -1;
        }

        function reset (open = 0) {
            if (open < 0 || open > 14) return false;
            board = [];
            for (let i = 0; i <= 14; i++) {
                board.push(i != open);
            }
            return true;
        }
        function tryMove (from,to) {
            if (!isValidMove(from,to)) return false; // is move well-formed?
            const over = getBetween(from,to);
            if (!board[from] || !board[over] || board[to]) return false; // is move currently possible?
            board[from] = false;
            board[over] = false;
            board[to] = true;
            return true;
        }

        function renderBoard () {
            let i = 0;
            for (let rowlen = 1; rowlen <= 5; rowlen++) {
                const indent = 5 - (rowlen-1);
                let rowStr = Array(indent).join(' ');
                for (let col = 0; col < rowlen; col++) {
                    rowStr += (board[i]) ? ' O' : ' _';
                    i++;
                }
                console.log(rowStr);
            }
        }

        reset(0);
        renderBoard();






        let dbgToggle = true;
        window.addEventListener('keydown', e => {
            // console.log(e.key);
            switch (e.key) {
            // difficulty settings
            // controls
            case 'a':
            case 'ArrowLeft':  tryGuess(0); if (lock.numDirs >= 1) controlsLeft.style.borderWidth = '4px'; break;
            case 'd':
            case 'ArrowRight': tryGuess(1); if (lock.numDirs >= 2) controlsRight.style.borderWidth = '4px'; break;
            case 'w':
            case 'ArrowUp':    tryGuess(2); if (lock.numDirs >= 3) controlsUp.style.borderWidth = '4px'; break;
            case 's':
            case 'ArrowDown':  tryGuess(3); if (lock.numDirs >= 4) controlsDown.style.borderWidth = '4px'; break;
            case ' ':          tryGuess(4); if (lock.numDirs >= 5) controlsCenter.style.borderWidth = '4px'; break;
            // debug
            case '`':
                console.log('DEV KEY');
                break;
            }
        });
        window.addEventListener('keyup', e => {
            switch (e.key) {
            // controls
            case 'a':
            case 'ArrowLeft':  controlsLeft.style.borderWidth = '2px'; break;
            case 'd':
            case 'ArrowRight': controlsRight.style.borderWidth = '2px'; break;
            case 'w':
            case 'ArrowUp':    controlsUp.style.borderWidth = '2px'; break;
            case 's':
            case 'ArrowDown':  controlsDown.style.borderWidth = '2px'; break;
            case ' ':          controlsCenter.style.borderWidth = '2px'; break;
            }
        });

        // init
        console.log(MSG_INSTRUCTIONS);

    </script>

</body>